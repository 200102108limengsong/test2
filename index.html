<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Cesium 3D Tiles Example</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.95/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        /* 选择器，选中了html，body元素，以及id为cesiumContainer的任何元素 */
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            /*元素外边距为0 */
            padding: 0;
            /*元素内边距为0*/
            overflow: hidden;
            /*超出指定范围的元素隐藏起来*/
        }

        .toolbar {
            position: absolute;
            top: 10px;
            left: 20px;
            background-color: rgba(50, 208, 129, 0.5);
        }

        .toolbar input{
            width: 140px;
            height: 30px;
        }

    </style>
</head>

<body>
    <div id="cesiumContainer"></div>
    
    <div class="toolbar">
        <input type="text" id="startHeight" placeholder="起始水位"><br>
        <input type="text" id="stopHeight" placeholder="停止水位"><br>
        <input type="text" id="speed" placeholder="速度"><br>
        <button onclick="draw()">绘制洪水区域</button>
    </div>


    <script>
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0Y2Q4MzVkNi1lM2JiLTRjYjItYjhkNi02ZGQ1MDc3ZDFlZjAiLCJpZCI6MTYwMjY5LCJpYXQiOjE3MTEyNjA5ODV9.y62hzpo7Asf7GG5dfhII6vRBTsRua6MeAmGqtSq6Sv4';

        var viewer = new Cesium.Viewer("cesiumContainer", {
            animation: false,
            timeline: false,
            shouldAnimate: true,
            terrainProvider:Cesium.createWorldTerrain()
        })
        
        //开启深度探测
        viewer.scene.globe.depthTestAgainstTerrain = true;
        var height; //当前水位
        var maxHeight;  //最高水位
        var speed;  //水位增长
        var positions=[];  //绘制多边形顶点
        var handler;   //???鼠标事件
        var addRegion  //添加多边形

        //调整相机视角
        viewer.scene.camera.setView({
            destination:Cesium.Cartesian3.fromDegrees(114,30,20)
        })
        //水位高度更新函数
        function updateHeight(){
            if (height<maxHeight)
                height +=speed;
            return height;
        }
        
        //绘制分析区域
        function addPolygon(hierarchy){
            addRegion = {
                id:'polygon',
                name:'矩形',
                show:true,
                polygon:{
                    hierarchy:hierarchy,
                    material:new Cesium.ImageMaterialProperty({
                        image:"http://localhost:8082/Geo/hongshui.png",
                        repeat:Cesium.Cartesian2(1.0,1.0),
                        transparent:true,
                        color:Cesium.Color.WHITE.withAlpha(1),
                    }),
                    height:new Cesium.CallbackProperty(updateHeight,false),
                }
            }
            viewer.entities.add(addRegion);
            handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK)
            handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)
        }

        function draw(){
            height = parseFloat(document.getElementById("startHeight").value);
            maxHeight = parseFloat(document.getElementById("stopHeight").value);
            speed = parseFloat(document.getElementById("speed").value);
            viewer.entities.remove(addRegion);
            handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);

            handler.setInputAction(function(event){
                var earthPosition = viewer.scene.pickPosition(event.position);
                positions.push(earthPosition);
            },
            Cesium.ScreenSpaceEventType.LEFT_CLICK);

            handler.setInputAction(function(event){
                addPolygon(positions);
                positions = [];
            },
            Cesium.ScreenSpaceEventType.RIGHT_CLICK);         
        }
    </script>





</body>

</html>